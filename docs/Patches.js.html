<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding meta -->
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>Patches.js</title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-light.css">
    
<svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/>
                <path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/>
            </g>
        </symbol>
    </defs>
</svg>

</head>
<body>
<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html"><div class="text">Home</div></a></h2><div class="search-box"><input type="text" placeholder="Search..." id="search-box" /><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-list-div"><h3>Tutorials</h3><ul><li class="" id=""><a href="tutorial-01-HelloModel.html">01-HelloModel</a></li><li class="" id=""><a href="tutorial-02-HelloHtml.html">02-HelloHtml</a></li><li class="" id=""><a href="tutorial-03-HelloServer.html">03-HelloServer</a></li><li class="" id=""><a href="tutorial-04-HelloView.html">04-HelloView</a></li><li class="" id=""><a href="tutorial-JavaScript.html">JavaScript</a></li></ul><h3>Classes</h3><ul><li class="accordion collapsed" id=2380348><div class="accordion-title"><a href="AgentArray.html">AgentArray</a><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16">
    <path 
        fill-rule="evenodd" 
        clip-rule="evenodd" 
        d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z">
    </path>
</svg></div><ul class='methods accordion-content'><li data-type='method'><a href="AgentArray.html#.fromArray">fromArray</a></li><li data-type='method'><a href="AgentArray.html#all">all</a></li><li data-type='method'><a href="AgentArray.html#ask">ask</a></li><li data-type='method'><a href="AgentArray.html#atIndex">atIndex</a></li><li data-type='method'><a href="AgentArray.html#clone">clone</a></li><li data-type='method'><a href="AgentArray.html#first">first</a></li><li data-type='method'><a href="AgentArray.html#forLoop">forLoop</a></li><li data-type='method'><a href="AgentArray.html#isEmpty">isEmpty</a></li><li data-type='method'><a href="AgentArray.html#last">last</a></li><li data-type='method'><a href="AgentArray.html#props">props</a></li><li data-type='method'><a href="AgentArray.html#sortBy">sortBy</a></li><li data-type='method'><a href="AgentArray.html#toArray">toArray</a></li><li data-type='method'><a href="AgentArray.html#typedSample">typedSample</a></li><li data-type='method'><a href="AgentArray.html#uniq">uniq</a></li><li data-type='method'><a href="AgentArray.html#with">with</a></li></ul></li><li class="accordion collapsed" id=263234><div class="accordion-title"><a href="AgentSet.html">AgentSet</a><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16">
    <path 
        fill-rule="evenodd" 
        clip-rule="evenodd" 
        d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z">
    </path>
</svg></div><ul class='methods accordion-content'><li data-type='method'><a href="AgentSet.html#addAgent">addAgent</a></li><li data-type='method'><a href="AgentSet.html#ask">ask</a></li><li data-type='method'><a href="AgentSet.html#askSet">askSet</a></li><li data-type='method'><a href="AgentSet.html#clear">clear</a></li><li data-type='method'><a href="AgentSet.html#getDefault">getDefault</a></li><li data-type='method'><a href="AgentSet.html#isBaseSet">isBaseSet</a></li><li data-type='method'><a href="AgentSet.html#isBreedSet">isBreedSet</a></li><li data-type='method'><a href="AgentSet.html#newBreed">newBreed</a></li><li data-type='method'><a href="AgentSet.html#protoMixin">protoMixin</a></li><li data-type='method'><a href="AgentSet.html#removeAgent">removeAgent</a></li><li data-type='method'><a href="AgentSet.html#setBreed">setBreed</a></li><li data-type='method'><a href="AgentSet.html#setDefault">setDefault</a></li><li data-type='method'><a href="AgentSet.html#withBreed">withBreed</a></li></ul></li><li class="accordion collapsed" id=8118162><div class="accordion-title"><a href="DataSet.html">DataSet</a><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16">
    <path 
        fill-rule="evenodd" 
        clip-rule="evenodd" 
        d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z">
    </path>
</svg></div><ul class='methods accordion-content'><li data-type='method'><a href="DataSet.html#.emptyDataSet">emptyDataSet</a></li></ul></li><li class="" id=""><a href="Link.html">Link</a></li><li class="" id=""><a href="Links.html">Links</a></li><li class="accordion collapsed" id=6156039><div class="accordion-title"><a href="Model.html">Model</a><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16">
    <path 
        fill-rule="evenodd" 
        clip-rule="evenodd" 
        d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z">
    </path>
</svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Model.html#linkBreeds">linkBreeds</a></li><li data-type='method'><a href="Model.html#patchBreeds">patchBreeds</a></li><li data-type='method'><a href="Model.html#reset">reset</a></li><li data-type='method'><a href="Model.html#setup">setup</a></li><li data-type='method'><a href="Model.html#startup">startup</a></li><li data-type='method'><a href="Model.html#step">step</a></li><li data-type='method'><a href="Model.html#tick">tick</a></li><li data-type='method'><a href="Model.html#turtleBreeds">turtleBreeds</a></li></ul></li><li class="" id=""><a href="Patch.html">Patch</a></li><li class="accordion collapsed" id=4378920><div class="accordion-title"><a href="Patches.html">Patches</a><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16">
    <path 
        fill-rule="evenodd" 
        clip-rule="evenodd" 
        d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z">
    </path>
</svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Patches.html#exportDataSet">exportDataSet</a></li><li data-type='method'><a href="Patches.html#importDataSet">importDataSet</a></li><li data-type='method'><a href="Patches.html#neighbors">neighbors</a></li><li data-type='method'><a href="Patches.html#neighbors4">neighbors4</a></li><li data-type='method'><a href="Patches.html#patchIndex">patchIndex</a></li></ul></li><li class="" id=""><a href="Turtle.html">Turtle</a></li><li class="accordion collapsed" id=1820542><div class="accordion-title"><a href="Turtles.html">Turtles</a><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16">
    <path 
        fill-rule="evenodd" 
        clip-rule="evenodd" 
        d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z">
    </path>
</svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Turtles.html#addAgent">addAgent</a></li><li data-type='method'><a href="Turtles.html#ask">ask</a></li><li data-type='method'><a href="Turtles.html#askSet">askSet</a></li><li data-type='method'><a href="Turtles.html#clear">clear</a></li><li data-type='method'><a href="Turtles.html#getDefault">getDefault</a></li><li data-type='method'><a href="Turtles.html#inPatches">inPatches</a></li><li data-type='method'><a href="Turtles.html#isBaseSet">isBaseSet</a></li><li data-type='method'><a href="Turtles.html#isBreedSet">isBreedSet</a></li><li data-type='method'><a href="Turtles.html#newBreed">newBreed</a></li><li data-type='method'><a href="Turtles.html#protoMixin">protoMixin</a></li><li data-type='method'><a href="Turtles.html#removeAgent">removeAgent</a></li><li data-type='method'><a href="Turtles.html#setBreed">setBreed</a></li><li data-type='method'><a href="Turtles.html#setDefault">setDefault</a></li><li data-type='method'><a href="Turtles.html#withBreed">withBreed</a></li></ul></li><li class="accordion collapsed" id=4606082><div class="accordion-title"><a href="World.html">World</a><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16">
    <path 
        fill-rule="evenodd" 
        clip-rule="evenodd" 
        d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z">
    </path>
</svg></div><ul class='methods accordion-content'><li data-type='method'><a href="World.html#.defaultOptions">defaultOptions</a></li><li data-type='method'><a href="World.html#.defaultWorld">defaultWorld</a></li><li data-type='method'><a href="World.html#bboxTransform">bboxTransform</a></li><li data-type='method'><a href="World.html#isOnWorld">isOnWorld</a></li><li data-type='method'><a href="World.html#random3DPoint">random3DPoint</a></li><li data-type='method'><a href="World.html#randomPatchPoint">randomPatchPoint</a></li><li data-type='method'><a href="World.html#randomPoint">randomPoint</a></li></ul></li></ul></div>
</nav>

<div id="main">
    
    <h1 id='page-title' class="page-title">Patches.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as util from './utils.js'
// import AgentArray from './AgentArray.js'
import AgentList from './AgentList.js'
import AgentSet from './AgentSet.js'
import DataSet from './DataSet.js'

/**
 * Patches are the world other AgentSets live on.
 * They define a coord system from the Model's World values:
 * minX, maxX, minY, maxY, (minZ, maxZ) (z optional)
 * Patches form a grid of Patch objects which can store world data
 * (elevation, fires, ant pheromones, buildings, roads, gis spatial data, water and so on)
 *
 * Created by class Model. Used by modeler in their Model subclass
 */
class Patches extends AgentSet {
    /**
     * Creates an instance of Patches.
     * @param {Model} model An instance of class Model
     * @param {Patch} AgentClass The Patch class managed by Patches
     * @param {string} name Name of the AgentSet
     */
    constructor(model, AgentClass, name) {
        // AgentSet sets these variables:
        // model, name, baseSet, world: model.world, agentProto: new AgentClass
        // REMIND: agentProto: defaults, agentSet, world, [name]=agentSet.baseSet
        super(model, AgentClass, name)

        // Skip if a breedSet (don't rebuild patches!).
        if (this.isBreedSet()) return

        this.populate()
        // this.setPixels()
        this.labels = [] // sparse array for labels
    }
    // Set up all the patches.
    populate() {
        util.repeat(this.model.world.numX * this.model.world.numY, i => {
            this.addAgent() // Object.create(this.agentProto))
        })
    }

    // Return the offsets from a patch for its 8 element neighbors.
    // Specialized to be faster than inRect below.
    neighborsOffsets(x, y) {
        const { minX, maxX, minY, maxY, numX } = this.model.world
        if (x === minX) {
            if (y === minY) return [-numX, -numX + 1, 1]
            if (y === maxY) return [1, numX + 1, numX]
            return [-numX, -numX + 1, 1, numX + 1, numX]
        }
        if (x === maxX) {
            if (y === minY) return [-numX - 1, -numX, -1]
            if (y === maxY) return [numX, numX - 1, -1]
            return [-numX - 1, -numX, numX, numX - 1, -1]
        }
        if (y === minY) return [-numX - 1, -numX, -numX + 1, 1, -1]
        if (y === maxY) return [1, numX + 1, numX, numX - 1, -1]
        return [-numX - 1, -numX, -numX + 1, 1, numX + 1, numX, numX - 1, -1]
    }
    // Return the offsets from a patch for its 4 element neighbors (N,S,E,W)
    neighbors4Offsets(x, y) {
        const numX = this.model.world.numX
        return this.neighborsOffsets(x, y).filter(
            n => Math.abs(n) === 1 || Math.abs(n) === numX
        ) // slightly faster
        // .filter((n) => [1, -1, numX, -numX].indexOf(n) >= 0)
        // .filter((n) => [1, -1, numX, -numX].includes(n)) // slower than indexOf
    }

    /**
     * Return the 8 patch
     * ["Moore" neighbors](https://en.wikipedia.org/wiki/Moore_neighborhood)
     * of the given patch.
     * Will be less than 8 on the edge of the patches
     *
     * @param {Patch} patch a Patch instance
     * @return {AgentList} An array of the neighboring patches
     */
    neighbors(patch) {
        const { id, x, y } = patch
        const offsets = this.neighborsOffsets(x, y)
        // const as = new AgentArray(offsets.length)
        const as = new AgentList(this.model, offsets.length)
        offsets.forEach((o, i) => {
            as[i] = this[o + id]
        })
        return as
    }

    /**
     * Return the 4 patch
     * ["Van Neumann" neighbors](https://en.wikipedia.org/wiki/Von_Neumann_neighborhood)
     * of the given patch.
     * Will be less than 4 on the edge of the patches
     *
     * @param {Patch} patch a Patch instance
     * @return {AgentList} An array of the neighboring patches
     */
    neighbors4(patch) {
        const { id, x, y } = patch
        const offsets = this.neighbors4Offsets(x, y)
        // const as = new AgentArray(offsets.length)
        const as = new AgentList(this.model, offsets.length)
        offsets.forEach((o, i) => {
            as[i] = this[o + id]
        })
        return as
    }

    /**
     * Assign a DataSet's values into the patches as the given property name
     *
     * @param {DataSet} dataSet An instance of [DataSet](./DataSet.html)
     * @param {string} property A Patch property name
     * @param {boolean} [useNearest=false] Resample to nearest dataset value?
     */
    importDataSet(dataSet, property, useNearest = false) {
        if (this.isBreedSet()) {
            // REMIND: error
            util.warn('Patches: exportDataSet called with breed, using patches')
            this.baseSet.importDataSet(dataSet, property, useNearest)
            return
        }
        const { numX, numY } = this.model.world
        const dataset = dataSet.resample(numX, numY, useNearest)
        this.ask(p => {
            p[property] = dataset.data[p.id]
        })
    }
    /**
     * Extract a property from each Patch as a DataSet
     *
     * @param {string} property The patch numeric property to extract
     * @param {Type} [Type=Array] The DataSet array's type
     * @return {DataSet} A DataSet of the patche's values
     */
    exportDataSet(property, Type = Array) {
        if (this.isBreedSet()) {
            util.warn('Patches: exportDataSet called with breed, using patches')
            return this.baseSet.exportDataSet(property, Type)
        }
        const { numX, numY } = this.model.world
        // let data = util.arrayProps(this, property)
        let data = this.props(property)
        data = util.convertArrayType(data, Type)
        return new DataSet(numX, numY, data)
    }

    // Return id/index given valid x,y integers
    /**
     * Return index into Patches given valid x,y integers
     *
     * @param {number} x Integer X value
     * @param {number} y Integer Y value
     * @return {number} Integer index into Patches array
     */
    patchIndex(x, y) {
        const { minX, maxY, numX } = this.model.world
        return x - minX + numX * (maxY - y)
    }

    // Return patch at x,y float values
    // Return undefined if off-world
    patch(x, y) {
        if (!this.model.world.isOnWorld(x, y)) return undefined
        const intX =
            x === this.model.world.maxXcor
                ? this.model.world.maxX
                : Math.round(x) // handle n.5 round up to n + 1
        const intY =
            y === this.model.world.maxYcor
                ? this.model.world.maxY
                : Math.round(y)
        return this.patchXY(intX, intY)
    }
    // Return the patch at x,y where both are valid integer patch coordinates.
    patchXY(x, y) {
        return this[this.patchIndex(x, y)]
    }

    // Patches in rectangle dx, dy from p, dx, dy integers.
    // Both dx &amp; dy are half width/height of rect
    patchRect(p, dx, dy = dx, meToo = true) {
        // Return cached rect if one exists.
        if (p.rectCache) {
            const index = this.cacheIndex(dx, dy, meToo)
            const rect = p.rectCache[index]
            if (rect) return rect
        }
        // const rect = new AgentArray()
        const rect = new AgentList(this.model)
        let { minX, maxX, minY, maxY } = this.model.world
        minX = Math.max(minX, p.x - dx)
        maxX = Math.min(maxX, p.x + dx)
        minY = Math.max(minY, p.y - dy)
        maxY = Math.min(maxY, p.y + dy)
        for (let y = minY; y &lt;= maxY; y++) {
            for (let x = minX; x &lt;= maxX; x++) {
                const pnext = this.patchXY(x, y)
                if (p !== pnext || meToo) rect.push(pnext)
            }
        }
        return rect
    }
    // Return patchRect given legal x, y values
    patchRectXY(x, y, dx, dy = dx, meToo = true) {
        return this.patchRect(this.patch(x, y), dx, dy, meToo)
    }

    // Performance: create a cached rect of this size in sparse array.
    // Index of cached rect is dx * dy + meToo ? 0 : -1.
    // This works for edge rects that are not that full size.
    // patchRect will use this if matches dx, dy, meToo.
    cacheIndex(dx, dy = dx, meToo = true) {
        return (2 * dx + 1) * (2 * dy + 1) + (meToo ? 0 : -1)
    }
    cacheRect(dx, dy = dx, meToo = true, clear = true) {
        const index = this.cacheIndex(dx, dy, meToo)
        this.ask(p => {
            if (!p.rectCache || clear) p.rectCache = []
            const rect = this.inRect(p, dx, dy, meToo)
            p.rectCache[index] = rect
        })
    }

    // Return patches within the patch rect, dx, dy integers
    // default is square &amp; meToo
    inRect(patch, dx, dy = dx, meToo = true) {
        const pRect = this.patchRect(patch, dx, dy, meToo)
        if (this.isBaseSet()) return pRect
        return pRect.withBreed(this)
    }
    // Return patches within float radius distance of patch
    inRadius(patch, radius, meToo = true) {
        const dxy = Math.ceil(radius)
        const pRect = this.inRect(patch, dxy, dxy, meToo)
        return pRect.inRadius(patch, radius, meToo)
    }
    // Patches in cone from patch in direction `heading`,
    // with `coneAngle` width and within float `radius`
    inCone(patch, radius, coneAngle, heading, meToo = true) {
        const dxy = Math.ceil(radius)
        const pRect = this.inRect(patch, dxy, dxy, meToo)
        // // Using AgentArray's inCone, using radians
        // heading = this.model.toRads(heading)
        // coneAngle = this.model.toAngleRads(coneAngle)
        // return pRect.inCone(patch, radius, coneAngle, heading, meToo)
        return pRect.inCone(patch, radius, coneAngle, heading, meToo)
    }

    // Return patch at distance and angle from obj's (patch or turtle)
    // x, y (floats). If off world, return undefined.
    // Does not take into account the angle of the agent.
    patchAtHeadingAndDistance(agent, heading, distance) {
        heading = this.model.toRads(heading)
        let { x, y } = agent
        x = x + distance * Math.cos(heading)
        y = y + distance * Math.sin(heading)
        return this.patch(x, y)
    }

    // Return true if patch on edge of world
    isOnEdge(patch) {
        const { x, y } = patch
        const { minX, maxX, minY, maxY } = this.model.world
        return x === minX || x === maxX || y === minY || y === maxY
    }
    // returns the edge patches for this breed.
    // generally called with patches.baseSet/model.patches.
    edgePatches() {
        return this.filter(p => this.isOnEdge(p))
    }

    // Diffuse the value of patch variable `p.v` by distributing `rate` percent
    // of each patch's value of `v` to its neighbors.
    // If the patch has less than 4/8 neighbors, return the extra to the patch.
    diffuse(v, rate) {
        this.diffuseN(8, v, rate)
    }
    diffuse4(v, rate) {
        this.diffuseN(4, v, rate)
    }
    diffuseN(n, v, rate) {
        // Note: for-of loops removed: chrome can't optimize them
        // test/apps/patches.js 22fps -> 60fps
        // zero temp variable if not yet set
        if (this[0]._diffuseNext === undefined) {
            // for (const p of this) p._diffuseNext = 0
            for (let i = 0; i &lt; this.length; i++) this[i]._diffuseNext = 0
        }

        // pass 1: calculate contribution of all patches to themselves and neighbors
        // for (const p of this) {
        for (let i = 0; i &lt; this.length; i++) {
            const p = this[i]
            const dv = p[v] * rate
            const dvn = dv / n
            const neighbors = n === 8 ? p.neighbors : p.neighbors4
            const nn = neighbors.length
            p._diffuseNext += p[v] - dv + (n - nn) * dvn
            // for (const n of neighbors) n._diffuseNext += dvn
            for (let i = 0; i &lt; neighbors.length; i++) {
                neighbors[i]._diffuseNext += dvn
            }
        }
        // pass 2: set new value for all patches, zero temp,
        // for (const p of this) {
        for (let i = 0; i &lt; this.length; i++) {
            const p = this[i]
            p[v] = p._diffuseNext
            p._diffuseNext = 0
        }
    }
}

export default Patches
</code></pre>
        </article>
    </section>




</div>

<footer id="footer">
  
</footer>

<script src="scripts/third-party/prettify.js"></script>
<script src="scripts/third-party/lang-css.js"></script>
<script src="scripts/search.js"></script>
<script src="scripts/third-party/fuse.js"></script>
<script type="text/javascript" src="scripts/misc.js"></script>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/fix-code-block.js"></script>
<script>
  var list = [{"title":"01-HelloModel","link":"01-HelloModel"},{"title":"02-HelloHtml","link":"02-HelloHtml"},{"title":"03-HelloServer","link":"03-HelloServer"},{"title":"04-HelloView","link":"04-HelloView"},{"title":"JavaScript","link":"JavaScript"},{"title":"AgentArray","link":"<a href=\"AgentArray.html\">AgentArray</a>"},{"title":"AgentArray.fromArray","link":"<a href=\"AgentArray.html#.fromArray\">AgentArray.fromArray &rtrif; undefined</a>"},{"title":"AgentArray#all","link":"<a href=\"AgentArray.html#all\">AgentArray &rtrif; all</a>"},{"title":"AgentArray#ask","link":"<a href=\"AgentArray.html#ask\">AgentArray &rtrif; ask</a>"},{"title":"AgentArray#atIndex","link":"<a href=\"AgentArray.html#atIndex\">AgentArray &rtrif; atIndex</a>"},{"title":"AgentArray#clone","link":"<a href=\"AgentArray.html#clone\">AgentArray &rtrif; clone</a>"},{"title":"AgentArray#first","link":"<a href=\"AgentArray.html#first\">AgentArray &rtrif; first</a>"},{"title":"AgentArray#forLoop","link":"<a href=\"AgentArray.html#forLoop\">AgentArray &rtrif; forLoop</a>"},{"title":"AgentArray#isEmpty","link":"<a href=\"AgentArray.html#isEmpty\">AgentArray &rtrif; isEmpty</a>"},{"title":"AgentArray#last","link":"<a href=\"AgentArray.html#last\">AgentArray &rtrif; last</a>"},{"title":"AgentArray#props","link":"<a href=\"AgentArray.html#props\">AgentArray &rtrif; props</a>"},{"title":"AgentArray#sortBy","link":"<a href=\"AgentArray.html#sortBy\">AgentArray &rtrif; sortBy</a>"},{"title":"AgentArray#toArray","link":"<a href=\"AgentArray.html#toArray\">AgentArray &rtrif; toArray</a>"},{"title":"AgentArray#typedSample","link":"<a href=\"AgentArray.html#typedSample\">AgentArray &rtrif; typedSample</a>"},{"title":"AgentArray#uniq","link":"<a href=\"AgentArray.html#uniq\">AgentArray &rtrif; uniq</a>"},{"title":"AgentArray#with","link":"<a href=\"AgentArray.html#with\">AgentArray &rtrif; with</a>"},{"title":"AgentSet","link":"<a href=\"AgentSet.html\">AgentSet</a>"},{"title":"AgentSet#addAgent","link":"<a href=\"AgentSet.html#addAgent\">AgentSet &rtrif; addAgent</a>"},{"title":"AgentSet#ask","link":"<a href=\"AgentSet.html#ask\">AgentSet &rtrif; ask</a>"},{"title":"AgentSet#askSet","link":"<a href=\"AgentSet.html#askSet\">AgentSet &rtrif; askSet</a>"},{"title":"AgentSet#clear","link":"<a href=\"AgentSet.html#clear\">AgentSet &rtrif; clear</a>"},{"title":"AgentSet#getDefault","link":"<a href=\"AgentSet.html#getDefault\">AgentSet &rtrif; getDefault</a>"},{"title":"AgentSet#isBaseSet","link":"<a href=\"AgentSet.html#isBaseSet\">AgentSet &rtrif; isBaseSet</a>"},{"title":"AgentSet#isBreedSet","link":"<a href=\"AgentSet.html#isBreedSet\">AgentSet &rtrif; isBreedSet</a>"},{"title":"AgentSet#newBreed","link":"<a href=\"AgentSet.html#newBreed\">AgentSet &rtrif; newBreed</a>"},{"title":"AgentSet#protoMixin","link":"<a href=\"AgentSet.html#protoMixin\">AgentSet &rtrif; protoMixin</a>"},{"title":"AgentSet#removeAgent","link":"<a href=\"AgentSet.html#removeAgent\">AgentSet &rtrif; removeAgent</a>"},{"title":"AgentSet#setBreed","link":"<a href=\"AgentSet.html#setBreed\">AgentSet &rtrif; setBreed</a>"},{"title":"AgentSet#setDefault","link":"<a href=\"AgentSet.html#setDefault\">AgentSet &rtrif; setDefault</a>"},{"title":"AgentSet#withBreed","link":"<a href=\"AgentSet.html#withBreed\">AgentSet &rtrif; withBreed</a>"},{"title":"DataSet","link":"<a href=\"DataSet.html\">DataSet</a>"},{"title":"DataSet.emptyDataSet","link":"<a href=\"DataSet.html#.emptyDataSet\">DataSet.emptyDataSet &rtrif; undefined</a>"},{"title":"Link","link":"<a href=\"Link.html\">Link</a>"},{"title":"Links","link":"<a href=\"Links.html\">Links</a>"},{"title":"Model","link":"<a href=\"Model.html\">Model</a>"},{"title":"Model#linkBreeds","link":"<a href=\"Model.html#linkBreeds\">Model &rtrif; linkBreeds</a>"},{"title":"Model#patchBreeds","link":"<a href=\"Model.html#patchBreeds\">Model &rtrif; patchBreeds</a>"},{"title":"Model#reset","link":"<a href=\"Model.html#reset\">Model &rtrif; reset</a>"},{"title":"Model#setup","link":"<a href=\"Model.html#setup\">Model &rtrif; setup</a>"},{"title":"Model#startup","link":"<a href=\"Model.html#startup\">Model &rtrif; startup</a>"},{"title":"Model#step","link":"<a href=\"Model.html#step\">Model &rtrif; step</a>"},{"title":"Model#tick","link":"<a href=\"Model.html#tick\">Model &rtrif; tick</a>"},{"title":"Model#turtleBreeds","link":"<a href=\"Model.html#turtleBreeds\">Model &rtrif; turtleBreeds</a>"},{"title":"Patch","link":"<a href=\"Patch.html\">Patch</a>"},{"title":"Patches","link":"<a href=\"Patches.html\">Patches</a>"},{"title":"Patches#exportDataSet","link":"<a href=\"Patches.html#exportDataSet\">Patches &rtrif; exportDataSet</a>"},{"title":"Patches#importDataSet","link":"<a href=\"Patches.html#importDataSet\">Patches &rtrif; importDataSet</a>"},{"title":"Patches#neighbors","link":"<a href=\"Patches.html#neighbors\">Patches &rtrif; neighbors</a>"},{"title":"Patches#neighbors4","link":"<a href=\"Patches.html#neighbors4\">Patches &rtrif; neighbors4</a>"},{"title":"Patches#patchIndex","link":"<a href=\"Patches.html#patchIndex\">Patches &rtrif; patchIndex</a>"},{"title":"Turtle","link":"<a href=\"Turtle.html\">Turtle</a>"},{"title":"Turtles","link":"<a href=\"Turtles.html\">Turtles</a>"},{"title":"Turtles#addAgent","link":"<a href=\"Turtles.html#addAgent\">Turtles &rtrif; addAgent</a>"},{"title":"Turtles#ask","link":"<a href=\"Turtles.html#ask\">Turtles &rtrif; ask</a>"},{"title":"Turtles#askSet","link":"<a href=\"Turtles.html#askSet\">Turtles &rtrif; askSet</a>"},{"title":"Turtles#clear","link":"<a href=\"Turtles.html#clear\">Turtles &rtrif; clear</a>"},{"title":"Turtles#getDefault","link":"<a href=\"Turtles.html#getDefault\">Turtles &rtrif; getDefault</a>"},{"title":"Turtles#inPatches","link":"<a href=\"Turtles.html#inPatches\">Turtles &rtrif; inPatches</a>"},{"title":"Turtles#isBaseSet","link":"<a href=\"Turtles.html#isBaseSet\">Turtles &rtrif; isBaseSet</a>"},{"title":"Turtles#isBreedSet","link":"<a href=\"Turtles.html#isBreedSet\">Turtles &rtrif; isBreedSet</a>"},{"title":"Turtles#newBreed","link":"<a href=\"Turtles.html#newBreed\">Turtles &rtrif; newBreed</a>"},{"title":"Turtles#protoMixin","link":"<a href=\"Turtles.html#protoMixin\">Turtles &rtrif; protoMixin</a>"},{"title":"Turtles#removeAgent","link":"<a href=\"Turtles.html#removeAgent\">Turtles &rtrif; removeAgent</a>"},{"title":"Turtles#setBreed","link":"<a href=\"Turtles.html#setBreed\">Turtles &rtrif; setBreed</a>"},{"title":"Turtles#setDefault","link":"<a href=\"Turtles.html#setDefault\">Turtles &rtrif; setDefault</a>"},{"title":"Turtles#withBreed","link":"<a href=\"Turtles.html#withBreed\">Turtles &rtrif; withBreed</a>"},{"title":"World","link":"<a href=\"World.html\">World</a>"},{"title":"World.defaultOptions","link":"<a href=\"World.html#.defaultOptions\">World.defaultOptions &rtrif; undefined</a>"},{"title":"World.defaultWorld","link":"<a href=\"World.html#.defaultWorld\">World.defaultWorld &rtrif; undefined</a>"},{"title":"World#bboxTransform","link":"<a href=\"World.html#bboxTransform\">World &rtrif; bboxTransform</a>"},{"title":"World#isOnWorld","link":"<a href=\"World.html#isOnWorld\">World &rtrif; isOnWorld</a>"},{"title":"World#random3DPoint","link":"<a href=\"World.html#random3DPoint\">World &rtrif; random3DPoint</a>"},{"title":"World#randomPatchPoint","link":"<a href=\"World.html#randomPatchPoint\">World &rtrif; randomPatchPoint</a>"},{"title":"World#randomPoint","link":"<a href=\"World.html#randomPoint\">World &rtrif; randomPoint</a>"}];
  var options = 
  setupSearch(list, options)
</script>

 






</body>
</html>
