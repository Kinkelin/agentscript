const{PI:t,atan:e,atan2:n,cos:s,floor:r,log:i,pow:o,sin:h,sinh:a,sqrt:c,tan:u}=Math,l=e=>e*t/180;var d=Object.freeze({__proto__:null,lon2x:function(t,e){return r((t+180)/360*o(2,e))},lat2y:function(e,n){const h=l(e);return r((1-i(u(h)+1/s(h))/t)*o(2,n-1))},lonlat2xy:function(t,e,n){return[this.lon2x(t,n),this.lat2y(e,n)]},x2lon:function(t,e){return t/o(2,e)*360-180},y2lat:function(n,s){return(e=>180*e/t)(e(a(t-2*t*n/o(2,s))))},xy2lonlat:function(t,e,n){return[this.x2lon(t,n),this.y2lat(e,n)]},xy2bbox:function(t,e,n){const[s,r]=this.xy2lonlat(t,e,n),[i,o]=this.xy2lonlat(t+1,e+1,n);return[s,o,i,r]},lonLat2bbox:function(t,e,n){const[s,r]=this.lonlat2xy(t,e,n);return this.xy2bbox(s,r,n)},bboxCenter:function(t){const[e,n,s,r]=t;return[(e+s)/2,(n+r)/2]},bboxCoords:function(t){const[e,n,s,r]=t;return[[e,r],[s,r],[s,n],[e,n]]},getOsmURL:function(t,e,n,s){return"https://overpass-api.de/api/interpreter?data="+encodeURIComponent(`[out:json][timeout:180][bbox:${t}${e}${n}${s}];\nway[highway];\n(._;>;);\nout;`)},lonLat2meters:function(t,e){const[r,i]=t.map(t=>l(t)),[o,a]=e.map(t=>l(t)),u=o-r,d=h((a-i)/2)**2+s(i)*s(a)*h(u/2)**2;return 1e3*(6378.137*(2*n(c(d),c(1-d))))},cloneJson:function(t){return JSON.parse(JSON.stringify(t))},areEqual:function(t,e){return JSON.stringify(t)===JSON.stringify(e)},minify:function(t){return JSON.stringify(t).replace(/,{"type":"Feature"/g,'\n,\n{"type":"Feature"')}});function f(t,e="text",n="GET"){return new Promise((s,r)=>{const i=new XMLHttpRequest;i.open(n,t),i.responseType=e,i.onload=()=>s(i.response),i.onerror=()=>r(Error(`Could not load ${t}: ${i.status}`)),i.send()})}function m(t=1e3){return new Promise(e=>{setTimeout(e,t)})}function g(){return v()}function p(t,e,n=g()){if(n)return new OffscreenCanvas(t,e);const s=document.createElement("canvas");return s.width=t,s.height=e,s}function y(t,e,n=g()){return p(t,e,n).getContext("2d")}function x(t,e=g()){const n=y(t.width,t.height,e);return n.drawImage(t,0,0),n.canvas}function w(t,e,n){t.width===e&&t.height==n||(t.width=e,t.height=n)}function b(t){t.save(),t.setTransform(1,0,0,1,0,0)}function O(t){return t.getImageData(0,0,t.canvas.width,t.canvas.height)}function S(t,e){b(t),t.drawImage(e,0,0,t.canvas.width,t.canvas.height),t.restore()}const A=new Set;function X(t,e=!1){A.has(t)||(e?console.warn(t):console.log(t),A.add(t))}function Y(t){X(t,!0)}function M(){return window.location.search.substr(1)}function k(t=M()){const e={},n=new URLSearchParams(t);for(var s of n.entries()){let[t,n]=s;(n.match(/^[0-9.]+$/)||n.match(/^[0-9.]+e[0-9]+$/))&&(n=Number(n)),["true","t",""].includes(n)&&(n=!0),["false","f"].includes(n)&&(n=!1),e[t]=n}return e}function v(){return!E()&&void 0===self.window}function E(){return"undefined"!=typeof global}const{PI:P}=Math,R=t=>Math.floor(Math.random()*t),I=(t,e)=>t+Math.floor(Math.random()*(e-t)),C=t=>Math.random()*t,j=(t,e)=>t+Math.random()*(e-t);const T=(t,e)=>(t%e+e)%e,B=(t,e,n)=>e+T(t-e,n-e);function $(t,e,n){return t<e?e:t>n?n:t}const z=(t,e,n)=>e<=t&&t<=n,N=(t,e,n)=>t<=e?t+(e-t)*n:t-(t-e)*n;const D=180/P,W=P/180,Z=t=>F(t*W),L=t=>_(t*D);function H(t){return _(90-t*D)}function q(t){return _(90-t)*W}function _(t){return T(t,360)}function F(t){return T(t,2*P)}function J(t,e){return _(t)===_(e)}const V=J;function U(t,e){let n=F(t-e);return n>P&&(n-=2*P),n}function G(t,e){let n=_(t-e);return n>180&&(n-=360),n}const K=G;function Q(t,e,n,s){return Math.atan2(s-e,n-t)}const tt=(t,e,n,s)=>(t-n)**2+(e-s)**2,et=(t,e,n,s)=>Math.sqrt(tt(t,e,n,s)),nt=(t,e,n,s,r,i)=>(t-s)**2+(e-r)**2+(n-i)**2,st=(t,e,n,s,r,i)=>Math.sqrt(nt(t,e,n,s,r,i));function rt(t,e,n,s,r,i,o){if(tt(i,o,t,e)>n*n)return!1;const h=Q(i,o,t,e);return s/2>=Math.abs(U(r,h))}const it=t=>t,ot=t=>e=>e[t];function ht(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function at(t,e){const n=t.indexOf(e);return-1!==n?t.splice(n,1):console.log(`removeArrayItem: ${e} not in array`),t}function ct(t,e){if(t.slice)for(let n=0,s=t.length;n<s;n++)e(t[n],n,t);else Object.keys(t).forEach(n=>e(t[n],n,t))}function ut(t,e,n=[]){for(let s=0;s<t;s++)e(s,n);return n}function lt(t,e){const n=t.constructor;if(n===Array)return t.concat(Yt(e,Array));const s=new n(t.length+e.length);return s.set(t),s.set(e,t.length),s}const dt=t=>t[R(t.length)];function ft(t,e){if(t.length<2)throw Error("otherOneOf: array.length < 2");do{var n=dt(t)}while(e===n);return n}const mt=t=>dt(Object.keys(t));function gt(t,e,n=!0){"string"==typeof e&&(e=ot(e));const s=(t,n)=>e(t)-e(n);return t.sort((t,e)=>n?s(t,e):-s(t,e))}function pt(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1)),s=t[e];t[e]=t[n],t[n]=s}return t}function yt(t,e,n){if(n<=1)throw Error("floatRamp: numItems must be > 1");const s=[];for(let r=0;r<n;r++)s.push(t+r/(n-1)*(e-t));return s}function xt(t,e,n){const s={};return n.forEach(n=>{s[n]=t[n][e]}),s}const wt=t=>({}.toString.call(t).match(/\s(\w+)/)[1].toLowerCase()),bt=(t,e)=>wt(t)===e,Ot=(t,e)=>e.includes(wt(t)),St=t=>bt(t,"string"),At=t=>bt(t,"object"),Xt=t=>"arraybuffer"===wt(t.buffer);function Yt(t,e){return t.constructor===e?t:e.from(t)}var Mt=Object.freeze({__proto__:null,imagePromise:function(t){return new Promise((e,n)=>{const s=new Image;s.crossOrigin="Anonymous",s.onload=()=>e(s),s.onerror=()=>n("Could not load image "+t),s.src=t})},imageBitmapPromise:async function(t){const e=await f(t,"blob");return createImageBitmap(e)},canvasBlobPromise:function(t,e="image/png",n=.95){return new Promise((s,r)=>{t.toBlob(t=>s(t),e,n)})},xhrPromise:f,timeoutPromise:m,timeoutLoop:async function(t,e=-1,n=0){let s=0;for(;s++!==e;)t(s-1),await m(n)},waitPromise:function(t,e=10){return new Promise(n=>{!function s(){if(t())return n();setTimeout(s,e)}()})},fetchType:async function(t,e="text"){const n=await fetch(t);if(!n.ok)throw Error("Not found: "+t);return await n[e]()},createCanvas:p,createCtx:y,cloneCanvas:x,resizeCtx:function(t,e,n){const s=x(t.canvas);t.canvas.width=e,t.canvas.height=n,t.drawImage(s,0,0)},setCanvasSize:w,setIdentity:b,setTextProperties:function(t,e,n="center",s="middle"){Object.assign(t,{font:e,textAlign:n,textBaseline:s})},drawText:function(t,e,n,s,r,i=!0){i&&b(t),t.fillStyle=r.css||r,t.fillText(e,n,s),i&&t.restore()},ctxImageData:O,clearCtx:function(t,e){const{width:n,height:s}=t.canvas;b(t),e&&"transparent"!==e?(e=e.css||e,t.fillStyle=e,t.fillRect(0,0,n,s)):t.clearRect(0,0,n,s),t.restore()},fillCtxWithImage:S,setCtxImage:function(t,e){w(t.canvas,e.width,e.height),S(t,e)},logOnce:X,warn:Y,timeit:function(t,e=1e5,n="test"){n=n+"-"+e,console.time(n);for(let n=0;n<e;n++)t(n);console.timeEnd(n)},fps:function(){const t="undefined"==typeof performance?Date:performance,e=t.now();let n=0;function s(){n++;const r=t.now()-e,i=parseFloat((n/(r/1e3)).toFixed(2));Object.assign(s,{fps:i,ms:r,start:e,steps:n})}return s.steps=0,s},pps:function(t,e=""){e&&console.log(e);let n=1,s="";for(;t;){if("function"==typeof t)s=t.constructor.toString();else{const e=Object.keys(t);s=e.length>0?`[${e.join(", ")}]`:`[${t.constructor.name}]`}console.log(`[${n++}]: ${s}`),t=Object.getPrototypeOf(t)}},toWindow:function(t,e=!1){Object.assign(window,t),console.log("toWindow:",Object.keys(t).join(", ")),e&&Object.keys(t).forEach(e=>console.log("  ",e,t[e]))},dump:function(t=window.model){let{patches:e,turtles:n,links:s}=t;Object.assign(window,{ps:e,ts:n,ls:s}),window.p=e.length>0?e.oneOf():{},window.t=n.length>0?n.oneOf():{},window.l=s.length>0?s.oneOf():{},console.log("debug: ps, ts, ls, p, t, l dumped to window")},setCssStyle:async function(t){const e=await fetch(t);if(!e.ok)throw Error("Not found: "+t);const n=await e.text();document.head.innerHTML+=`<style>${n}</style>`},getQueryString:M,parseQueryString:k,RESTapi:function(t){return Object.assign(t,k())},inWorker:v,inNode:E,inDeno:function(){return!!Deno},printToPage:function(t,e=document.body){"object"==typeof t&&(t=JSON.stringify(t,null,2)),t="<pre>"+t+"</pre>","string"==typeof e&&(e=document.getElementById(e)),e.style.fontFamily="monospace",e.innerHTML+=t},getEventXY:function(t,e){const n=t.getBoundingClientRect();return[e.clientX-n.left,e.clientY-n.top]},fcnToWorker:function(t){const e=document.location.href.replace(/\/[^\/]+$/,"/"),n=`(${t.toString(e)})("${e}")`,s=URL.createObjectURL(new Blob([n],{type:"text/javascript"})),r=new Worker(s);return r.onerror=function(t){console.log("Worker ERROR: Line ",t.lineno,": ",t.message)},r},randomInt:R,randomInt2:I,randomFloat:C,randomFloat2:j,randomCentered:t=>j(-t/2,t/2),randomNormal:function(t=0,e=1){const[n,s]=[1-Math.random(),Math.random()];return Math.sqrt(-2*Math.log(n))*Math.cos(2*P*s)*e+t},randomSeed:function(t=123456){t%=2147483647,Math.random=()=>((t=16807*t%2147483647)-1)/2147483646},precision:function(t,e=4){if(Array.isArray(t))return t.map(t=>this.precision(t,e));const n=10**e;return Math.round(t*n)/n},isPowerOf2:t=>0==(t&t-1),nextPowerOf2:t=>Math.pow(2,Math.ceil(Math.log2(t))),mod:T,wrap:B,clamp:$,isBetween:z,lerp:N,lerpScale:function(t,e,n){if(e===n)throw Error("lerpScale: lo === hi");return((t=$(t,e,n))-e)/(n-e)},degToRad:Z,radToDeg:L,radToHeading:H,headingToRad:q,radToHeadingAngle:function(t){return-L(t)},headingAngleToRad:function(t){return-Z(t)},degToHeading:t=>_(90-t),headingToDeg:t=>_(90-t),mod360:_,mod2pi:F,modpipi:function(t){return T(t,2*P)-P},mod180180:function(t){return _(t)-180},degreesEqual:J,radsEqual:function(t,e){return F(t)===F(e)},headingsEq:V,subtractRadians:U,subtractDegrees:G,subtractHeadings:K,radiansTowardXY:Q,headingTowardXY:function(t,e,n,s){return H(Q(t,e,n,s))},degreesTowardXY:function(t,e,n,s){return L(Q(t,e,n,s))},sqDistance:tt,distance:et,sqDistance3:nt,distance3:st,inCone:rt,sampleModel:function(t){const e=function(t,e=0,n=!0){let s=n;const r=["rectCache"];return JSON.stringify(t,(t,e)=>{if(r.includes(t))return;return Array.isArray(e)&&e.length>0&&Number.isInteger(e[0].id)&&!s?e.map(t=>t.id):(s=!1,e)},e)}({ticks:t.ticks,model:Object.keys(t),patches:t.patches.length,patch:t.patches.oneOf(),turtles:t.turtles.length,turtle:t.turtles.oneOf(),links:t.links.length,link:t.links.oneOf()});return JSON.parse(e)},identityFcn:it,noopFcn:()=>{},propFcn:ot,arraysEqual:ht,removeArrayItem:at,arraysToString:t=>t.map(t=>""+t).join(","),forLoop:ct,repeat:ut,step:function(t,e,n){for(let s=0;s<t;s+=e)n(s)},range:function(t){return ut(t,(t,e)=>{e[t]=t})},override:function(t,e){const n=t;return ct(t,(t,s)=>{e[s]&&(n[s]=e[s])}),n},concatArrays:lt,objectToString:function(t,e=2,n=!0){let s=JSON.stringify(t,null,e);return n&&(s=s.replace(/"([^"]+)":/gm,"$1:")),s},objectsEqual:(t,e)=>JSON.stringify(t)===JSON.stringify(e),oneOf:dt,otherOneOf:ft,oneKeyOf:mt,oneValOf:t=>t[mt(t)],sortNums:function(t,e=!0){return t.sort((t,n)=>e?t-n:n-t)},sortObjs:gt,shuffle:pt,union:function(t,e){return Array.from(new Set(t.concat(e)))},intersection:function(t,e){const n=new Set(e);return t.filter(t=>n.has(t))},difference:function(t,e){const n=new Set(e);return t.filter(t=>!n.has(t))},floatRamp:yt,integerRamp:function(t,e,n=Math.abs(e-t)+1){return yt(t,e,n).map(t=>Math.round(t))},arrayLast:t=>t[t.length-1],isOofA:function(t){return!!At(t)&&Object.values(t).every(t=>Xt(t))},toOofA:function(t,e){const n=t.length,s=Object.keys(e),r={};return s.forEach(t=>{r[t]=new e[t](n)}),ct(t,(t,e)=>{s.forEach(n=>r[n][e]=t[n])}),r},oofaObject:xt,toAofO:function(t,e=Object.keys(t)){const n=t[e[0]].length,s=new Array(n);return ct(s,(n,r)=>{s[r]=xt(t,r,e)}),s},oofaBuffers:function(t){const e=[];return ct(t,t=>ct(t,t=>e.push(t.buffer))),e},typeOf:wt,isType:bt,isOneOfTypes:Ot,isString:St,isObject:At,isArray:t=>Array.isArray(t),isNumber:t=>bt(t,"number"),isInteger:t=>Number.isInteger(t),isFunction:t=>bt(t,"function"),isImage:t=>bt(t,"image"),isCanvas:t=>Ot(t,["htmlcanvaselement","offscreencanvas"]),isImageable:t=>Ot(t,["image","htmlimageelement","htmlcanvaselement","offscreencanvas","imagebitmap"]),isTypedArray:Xt,isUintArray:t=>/^uint.*array$/.test(wt(t)),isIntArray:t=>/^int.*array$/.test(wt(t)),isFloatArray:t=>/^float.*array$/.test(wt(t)),isLittleEndian:function(){const t=new Uint32Array([16909060]);return 4===new Uint8ClampedArray(t.buffer)[0]},convertArrayType:Yt});class kt extends Array{static fromArray(t){return Object.setPrototypeOf(t,kt.prototype)}constructor(...t){super(...t)}toArray(){return Object.setPrototypeOf(this,Array.prototype),this}isEmpty(){return 0===this.length}first(){return this[0]}last(){return this[this.length-1]}atIndex(t){if(0===this.length)return;return this[T(t,this.length)]}all(t){return this.every(t)}props(t,e=kt){const n=new e(this.length);for(let e=0;e<this.length;e++)n[e]=this[e][t];return n}typedSample(t){const e={};return ct(t,(t,n)=>{e[n]=this.props(n,t)}),e}uniq(){return kt.from(new Set(this))}forLoop(t){for(let e=0,n=this.length;e<n;e++)t(this[e],e,this);return this}ask(t){const e=this.length;for(let n=0;n<Math.min(e,this.length);n++)t(this[n],n,this);if(e!=this.length){Y(`AgentArray.ask array mutation: ${this.name||this.constructor.name}: ${this.length<e?"decreasing":"increasing"}`)}}with(t){return this.filter(t)}other(t){return this.filter(e=>e!==t)}count(t){return this.reduce((e,n)=>e+(t(n)?1:0),0)}sum(t){return this.reduce((e,n)=>e+(t?n[t]:n),0)}avg(t){return this.sum(t)/this.length}min(t){return this.reduce((e,n)=>Math.min(e,t?n[t]:n),1/0)}max(t){return this.reduce((e,n)=>Math.max(e,t?n[t]:n),-1/0)}extent(t){return[this.min(t),this.max(t)]}histogram(t,e=10,n=this.min(t),s=this.max(t)){const r=(s-n)/e,i=new kt(e);return i.fill(0),this.ask(o=>{const h=t?o[t]:o;if(h<n||h>s)Y(`histogram bounds error: ${h}: ${n}-${s}`);else{let t=Math.floor((h-n)/r);t===e&&t--,i[t]++}}),i.parameters={key:t,bins:e,min:n,max:s,binSize:r,arraySize:this.length},i}clone(){return this.slice(0)}shuffle(){return pt(this)}sortBy(t,e=!0){return gt(this,t,e),this}remove(t,e){const n=this.agentIndex(t,e);return-1!==n?this.splice(n,1):Y(`remove: ${t} not in AgentArray`),this}insert(t,e){const n=this.sortedIndex(t,e);if(this[n]===t)throw Error("insert: item already in AgentArray");this.splice(n,0,t)}sortedIndex(t,e=it){St(e)&&(e=ot(e));const n=e(t);let s=0,r=this.length;for(;s<r;){const t=s+r>>>1;e(this[t])<n?s=t+1:r=t}return s}agentIndex(t,e){if(!e)return this.indexOf(t);const n=this.sortedIndex(t,e);return this[n]===t?n:-1}contains(t,e){return this.agentIndex(t,e)>=0}oneOf(){return dt(this)}otherOneOf(t){return ft(this,t)}otherNOf(t,e){if(this.length<t)throw Error("AgentArray: otherNOf: length < N");return this.clone().remove(e).shuffle().slice(0,t)}minOrMaxOf(t,e,n=!1){if(this.isEmpty())throw Error("min/max OneOf: empty array");"string"==typeof e&&(e=ot(e));let s=null,r=t?1/0:-1/0;for(let n=0;n<this.length;n++){const i=this[n],o=e(i);(t&&o<r||!t&&o>r)&&([s,r]=[i,o])}return n?[s,r]:s}minOneOf(t){return this.minOrMaxOf(!0,t)}maxOneOf(t){return this.minOrMaxOf(!1,t)}minValOf(t){return this.minOrMaxOf(!0,t,!0)}maxValOf(t){return this.minOrMaxOf(!1,t,!0)}nOf(t){if(t>this.length)throw Error("nOf: n larger than AgentArray");if(t===this.length)return this;const e=new kt;for(;e.length<t;){const t=this.oneOf();t in e||e.push(t)}return e}minOrMaxNOf(t,e,n){if(e>this.length)throw Error("min/max nOf: n larger than AgentArray");const s=this.clone().sortBy(n);return t?s.clone(0,e):s.clone(s.length-e)}minNOf(t,e){return this.minOrMaxNOf(!0,t,e)}maxNOf(t,e){return this.minOrMaxNOf(!1,t,e)}inRect(t,e,n=e,s=!1){const r=new kt,i=t.x-e,o=t.x+e,h=t.y-n,a=t.y+n;return this.ask(e=>{i<=e.x&&e.x<=o&&h<=e.y&&e.y<=a&&(s||t!==e)&&r.push(e)}),r}inRadius(t,e,n=!1){const s=new kt,r=e*e,i=tt;return this.ask(e=>{i(t.x,t.y,e.x,e.y)<=r&&(n||t!==e)&&s.push(e)}),s}inCone(t,e,n,s,r=!1){const i=new kt;return this.ask(o=>{rt(o.x,o.y,e,n,s,t.x,t.y)&&(r||t!==o)&&i.push(o)}),i}}class vt extends kt{model;name;baseSet;AgentClass;static get[Symbol.species](){return kt}constructor(t,e,n,s=null){super(),s=s||this,Object.assign(this,{model:t,name:n,baseSet:s,AgentClass:e}),this.isBaseSet()?(this.breeds={},this.ID=0):(Object.setPrototypeOf(this,Object.getPrototypeOf(s)),this.baseSet.breeds[n]=this),this.ownVariables=[],this.agentProto=new e(this),this.protoMixin(this.agentProto,e)}protoMixin(t,e){Object.assign(t,{agentSet:this,model:this.model}),t[this.baseSet.name]=this.baseSet,e.prototype.setBreed||(Object.assign(e.prototype,{setBreed(t){t.setBreed(this)},getBreed(){return this.agentSet},isBreed(t){return this.agentSet===t}}),Object.defineProperty(e.prototype,"breed",{get:function(){return this.agentSet}}))}newBreed(t){return new vt(this.model,this.AgentClass,t,this)}isBreedSet(){return this.baseSet!==this}isBaseSet(){return this.baseSet===this}withBreed(t){return this.filter(e=>e.agentSet===t)}create(){console.log("AgentSet: Abstract method called: "+this)}addAgent(t){return t=t||Object.create(this.agentProto),this.isBreedSet()?this.baseSet.addAgent(t):(t.id=this.ID++,t.agentConstructor&&t.agentConstructor()),this.push(t),t}clear(){for(;!this.isEmpty();)this.last().die()}removeAgent(t){return this.isBreedSet()&&this.baseSet.remove(t,"id"),this.remove(t,"id"),this}setDefault(t,e){return this.agentProto[t]=e,this}getDefault(t){return this.agentProto[t]}setBreed(t){if(t.agentSet===this)return;t.agentSet.isBreedSet()&&t.agentSet.remove(t,"id"),this.isBreedSet()&&this.insert(t,"id");const e=t.agentSet.ownVariables;for(const n of e)this.ownVariables.includes(n)||delete t[n];for(const n of this.ownVariables)e.includes(n)||(t[n]=0);return Object.setPrototypeOf(t,this.agentProto)}ask(t){if(0===this.length)return;const e=this.last().id;for(let n=0;n<this.length&&this[n].id<=e;n++)t(this[n],n,this)}askSet(t){0!==this.length&&("patches"===this.name?super.forLoop(t):this.isBaseSet()?this.baseSetAsk(t):this.isBreedSet()&&this.cloneAsk(t))}baseSetAsk(t){if(0===this.length)return;const e=this.last().id;for(let n=0;n<this.length;n++){const s=this[n],r=s.id;if(r>e)break;if(t(s,n,this),n>=this.length)break;if(this[n].id>r)for(;n>=0&&this[n].id>r;)n--}}cloneAsk(t){const e=this.clone();for(let n=0;n<e.length;n++){const s=e[n];s.breed==this&&s.id>0&&t(s,n,e)}}}class Et{static emptyDataSet(t,e,n){return new Et(t,e,new n(t*e))}constructor(t,e,n){if(n.length!==t*e)throw Error(`new DataSet length: ${n.length} !== ${t} * ${e}`);Object.assign(this,{width:t,height:e,data:n})}checkXY(t,e){if(!this.inBounds(t,e))throw Error(`DataSet: x,y out of range: ${t}, ${e}`)}inBounds(t,e){return z(t,0,this.width-1)&&z(e,0,this.height-1)}dataType(){return this.data.constructor}type(){return this.constructor}toIndex(t,e){return t+e*this.width}toXY(t){return[t%this.width,Math.floor(t/this.width)]}getXY(t,e){return this.data[this.toIndex(t,e)]}setXY(t,e,n){this.data[this.toIndex(t,e)]=n}sample(t,e,n=!0){return this.checkXY(t,e),n?this.nearest(t,e):this.bilinear(t,e)}nearest(t,e){return this.getXY(Math.round(t),Math.round(e))}bilinear(t,e){const n=Math.floor(t),s=Math.floor(e),r=this.toIndex(n,s),i=this.width,o=t-n,h=e-s,a=1-o,c=1-h;return this.data[r]*a*c+(this.data[r+1]||0)*o*c+(this.data[r+i]||0)*a*h+(this.data[r+1+i]||0)*o*h}clone(){return new Et(this.width,this.height,this.data.slice(0))}emptyDataSet(t,e,n=this.dataType()){return Et.emptyDataSet(t,e,n)}emptyArray(t){return new(this.type())(t)}resample(t,e,n=!0,s=Array){if(t===this.width&&e===this.height)return this.copy();const r=Et.emptyDataSet(t,e,s);for(let s=0;s<e;s++)for(let i=0;i<t;i++)r.setXY(i,s,this.sample(i*(this.width-1)/(t-1),s*(this.height-1)/(e-1),n));return r}scale(t,e){const n=this.min(),s=(e-t)/(this.max()-n),r=t-s*n;return this.map(t=>s*t+r)}subset(t,e,n,s){if(t+n>this.width||e+s>this.height)throw Error("DataSet.subSet: params out of range");const r=this.emptyDataSet(n,s);for(let i=0;i<n;i++)for(let n=0;n<s;n++)r.setXY(i,n,this.getXY(i+t,n+e));return r}map(t){return new Et(this.width,this.height,this.data.map(t))}col(t){const[e,n,s]=[this.width,this.height,this.data];if(t>=e)throw Error(`col: x out of range width: ${e} x: ${t}`);const r=this.emptyArray(n);for(let i=0;i<n;i++)r[i]=s[t+i*e];return r}row(t){const[e,n]=[this.width,this.height];if(t>=n)throw Error(`row: y out of range height: ${n} x: ${t}`);return this.data.slice(t*e,(t+1)*e)}convertType(t){this.data=Yt(this.data,t)}concatEast(t){const[e,n]=[this.width,this.height],[s,r]=[t.width,t.height];if(n!==r)throw Error(`concatEast: heights not equal ${n}, ${r}`);const i=this.emptyDataSet(e+s,n);for(let t=0;t<n;t++)for(let n=0;n<e;n++)i.setXY(t,n,this.getXY(t,n));for(let n=0;n<r;n++)for(let r=0;r<s;r++)i.setXY(n+e,r,t.getXY(n,r));return i}concatSouth(t){const[e,n,s]=[this.width,this.height,this.data];if(e!==t.width)throw Error(`concatSouth: widths not equal ${e}, ${t.width}`);const r=lt(s,t.data);return new Et(e,n+t.height,r)}transformCoords(t,e,n,s,r,i){return[(t-n)*(this.width-1)/r,(s-e)*(this.height-1)/i]}coordSample(t,e,n,s,r,i,o=!0){const[h,a]=this.transformCoords(t,e,n,s,r,i);return this.sample(h,a,o)}neighborhood(t,e,n=[]){n.length=0;const s=0===t||t===this.width-1||0===e||e===this.height-1;for(let r=-1;r<=1;r++)for(let i=-1;i<=1;i++){let o=t+i,h=e+r;s&&(o=$(o,0,this.width-1),h=$(h,0,this.height-1)),n.push(this.data[this.toIndex(o,h)])}return n}convolve(t,e=1,n=!1){const[s,r,i,o]=n?[1,1,this.height-1,this.width-1]:[0,0,this.height,this.width],h=this.emptyDataSet(o,i),a=h.data;let c=0;for(let n=r;n<i;n++)for(let r=s;r<o;r++){const s=this.neighborhood(r,n);let i=0;for(let e=0;e<t.length;e++)i+=t[e]*s[e];a[c++]=i*e}return h}dzdx(t=2,e=1/8){return this.convolve([-1,0,1,-t,0,t,-1,0,1],e)}dzdy(t=2,e=1/8){return this.convolve([1,t,1,0,0,0,-1,-t,-1],e)}laplace8(){return this.convolve([-1,-1,-1,-1,8,-1,-1,-1,-1])}laplace4(){return this.convolve([0,-1,0,-1,4,-1,0,-1,0])}blur(t=.0625){return this.convolve([1,2,1,2,4,2,1,2,1],t)}edge(){return this.convolve([1,1,1,1,-7,1,1,1,1])}slopeAndAspect(t=1,e=!0){const n=this.dzdx(),s=this.dzdy();let[r,i]=[[],[]];const[o,h]=[n.height,n.width];for(let a=0;a<o;a++)for(let o=0;o<h;o++){const[h,c]=[n.getXY(o,a),s.getXY(o,a)];i.push(Math.atan(et(0,0,h,c))/t);let u=Math.atan2(-c,-h);e&&u<0&&(u+=2*Math.PI),r.push(u)}return i=new Et(h,o,i),r=new Et(h,o,r),{slope:i,aspect:r,dzdx:n,dzdy:s}}max(){return this.data.reduce((t,e)=>Math.max(t,e))}min(){return this.data.reduce((t,e)=>Math.min(t,e))}extent(){return[this.min(),this.max()]}sum(){return this.data.reduce((t,e)=>t+e,0)}normalize(t=0,e=1){const[n,s]=this.extent(),r=1/(s-n),i=this.data.map(s=>N(t,e,r*(s-n)));return new Et(this.width,this.height,i)}equals(t){return this.width===t.width&&this.height===t.height&&ht(this.data,t.data)}}class Pt{agentSet;model;name;static defaultVariables(){return{end0:null,end1:null,width:1}}constructor(){Object.assign(this,Pt.defaultVariables())}init(t,e){this.end0=t,this.end1=e,t.links.push(this),e.links.push(this)}die(){this.agentSet.removeAgent(this),at(this.end0.links,this),at(this.end1.links,this),this.id=-1}bothEnds(){return kt.fromArray([this.end0,this.end1])}length(){return this.end0.distance(this.end1)}direction(){const{x0:t,x1:e,y0:n,y1:s}=this,r=Math.atan2(s-n,e-t);return this.model.fromRads(r)}otherEnd(t){if(t===this.end0)return this.end1;if(t===this.end1)return this.end0;throw Error("Link.otherEnd: turtle not a link turtle: "+t)}distanceXY(t,e){return this.bothEnds().map(n=>n.distanceXY(t,e)).sum()-this.length()}get x0(){return this.end0.x}get y0(){return this.end0.y}get z0(){return this.end0.z?this.end0.z:0}get x1(){return this.end1.x}get y1(){return this.end1.y}get z1(){return this.end1.z?this.end1.z:0}}class Rt extends vt{createOne(t,e,n=(t=>{})){const s=this.addAgent();return s.init(t,e),n(s),s}create(t,e,n=(t=>{})){return Array.isArray(e)||(e=[e]),e.map(e=>this.createOne(t,e,n))}}class It{maxX=16;maxY=16;maxZ=16;minX=-16;minY=-16;minZ=-16;constructor(t={}){Object.assign(this,t),this.setWorld()}static defaultOptions(t=16,e=t,n=Math.max(t,e)){return{minX:-t,maxX:t,minY:-e,maxY:e,minZ:-n,maxZ:n}}static defaultWorld(t=16,e=t,n=t){return new It(It.defaultOptions(t,e,n))}setWorld(){let{minX:t,maxX:e,minY:n,maxY:s,minZ:r,maxZ:i}=this;ct({minX:t,maxX:e,minY:n,maxY:s,minZ:r,maxZ:i},(t,e)=>{if(!Number.isInteger(t))throw Error(`${e}:${t} must be an integer`)}),this.numX=this.width=e-t+1,this.numY=this.height=s-n+1,this.numZ=this.depth=i-r+1,this.minXcor=t-.5,this.maxXcor=e+.5,this.minYcor=n-.5,this.maxYcor=s+.5,this.minZcor=r-.5,this.maxZcor=i+.5,this.centerX=(t+e)/2,this.centerY=(n+s)/2,this.centerZ=(r+i)/2,this.numPatches=this.numX*this.numY}randomPoint(){return[j(this.minXcor,this.maxXcor),j(this.minYcor,this.maxYcor)]}random3DPoint(){return[j(this.minXcor,this.maxXcor),j(this.minYcor,this.maxYcor),j(this.minZcor,this.maxZcor)]}randomPatchPoint(){return[I(this.minX,this.maxX),I(this.minY,this.maxY)]}isOnWorld(t,e,n=this.centerZ){return this.minXcor<=t&&t<=this.maxXcor&&this.minYcor<=e&&e<=this.maxYcor&&this.minZcor<=n&&n<=this.maxZcor}bboxTransform(t,e,n,s){return new Ct(t,e,n,s,this)}getWorldSize(t=1){return[this.numX*t,this.numY*t]}setEuclideanTransform(t,e){this.setCanvasSize(t.canvas,e),t.restore(),t.save(),t.scale(e,-e),t.translate(-this.minXcor,-this.maxYcor)}patchSize(t){const{numX:e,numY:n}=this,{clientWidth:s,clientHeight:r}=t,i=s/e,o=r/n;if(i!==o)throw Error(`World patchSize: x/y sizes differ ${i}, ${o}`);return i}setCanvasSize(t,e){const[n,s]=this.getWorldSize(e);w(t,n,s)}pixelXYtoPatchXY(t,e,n){return[this.minXcor+t/n,this.maxYcor-e/n]}patchXYtoPixelXY(t,e,n){return[(t-this.minXcor)*n,(this.maxYcor-e)*n]}xyToPatchIndex(t,e){if(!this.isOnWorld(t,e))return;const{minX:n,maxX:s,maxY:r,numX:i,maxXcor:o,maxYcor:h}=this;return(t=t===o?s:Math.round(t))-n+i*(r-(e=e===h?r:Math.round(e)))}}class Ct{constructor(t,e,n,s,r){t<n&&console.log("flipX"),s<e&&console.log("flipY"),t<n&&([t,n]=[n,t]),s<e&&([s,e]=[e,s]);const{maxXcor:i,maxYcor:o,minXcor:h,minYcor:a}=r,c=(t-n)/(i-h),u=(s-e)/(o-a),l=(t+n-c*(i+h))/2,d=(s+e-u*(o+a))/2;this.setClassProperties({mx:c,my:u,bx:l,by:d})}setClassProperties(t){this.mx=t.mx,this.my=t.my,this.bx=t.bx,this.by=t.by}toWorld(t){const{mx:e,my:n,bx:s,by:r}=this,[i,o]=t;return[(i-s)/e,(o-r)/n]}toBBox(t){const{mx:e,my:n,bx:s,by:r}=this,[i,o]=t;return[e*i+s,n*o+r]}}class jt extends vt{constructor(t,e,n){super(t,e,n),this.isBreedSet()||(this.populate(),this.labels=[])}populate(){ut(this.model.world.numX*this.model.world.numY,t=>{this.addAgent()})}neighborsOffsets(t,e){const{minX:n,maxX:s,minY:r,maxY:i,numX:o}=this.model.world;return t===n?e===r?[-o,1-o,1]:e===i?[1,o+1,o]:[-o,1-o,1,o+1,o]:t===s?e===r?[-o-1,-o,-1]:e===i?[o,o-1,-1]:[-o-1,-o,o,o-1,-1]:e===r?[-o-1,-o,1-o,1,-1]:e===i?[1,o+1,o,o-1,-1]:[-o-1,-o,1-o,1,o+1,o,o-1,-1]}neighbors4Offsets(t,e){const n=this.model.world.numX;return this.neighborsOffsets(t,e).filter(t=>1===Math.abs(t)||Math.abs(t)===n)}neighbors(t){const{id:e,x:n,y:s}=t,r=this.neighborsOffsets(n,s),i=new kt(r.length);return r.forEach((t,n)=>{i[n]=this[t+e]}),i}neighbors4(t){const{id:e,x:n,y:s}=t,r=this.neighbors4Offsets(n,s),i=new kt(r.length);return r.forEach((t,n)=>{i[n]=this[t+e]}),i}importDataSet(t,e,n=!1){if(this.isBreedSet())return Y("Patches: exportDataSet called with breed, using patches"),void this.baseSet.importDataSet(t,e,n);const{numX:s,numY:r}=this.model.world,i=t.resample(s,r,n);this.ask(t=>{t[e]=i.data[t.id]})}exportDataSet(t,e=Array){if(this.isBreedSet())return Y("Patches: exportDataSet called with breed, using patches"),this.baseSet.exportDataSet(t,e);const{numX:n,numY:s}=this.model.world;let r=this.props(t);return r=Yt(r,e),new Et(n,s,r)}patchIndex(t,e){const{minX:n,maxY:s,numX:r}=this.model.world;return t-n+r*(s-e)}patch(t,e){if(!this.model.world.isOnWorld(t,e))return;const n=t===this.model.world.maxXcor?this.model.world.maxX:Math.round(t),s=e===this.model.world.maxYcor?this.model.world.maxY:Math.round(e);return this.patchXY(n,s)}patchXY(t,e){return this[this.patchIndex(t,e)]}patchRect(t,e,n=e,s=!0){if(t.rectCache){const r=this.cacheIndex(e,n,s),i=t.rectCache[r];if(i)return i}const r=new kt;let{minX:i,maxX:o,minY:h,maxY:a}=this.model.world;i=Math.max(i,t.x-e),o=Math.min(o,t.x+e),h=Math.max(h,t.y-n),a=Math.min(a,t.y+n);for(let e=h;e<=a;e++)for(let n=i;n<=o;n++){const i=this.patchXY(n,e);(t!==i||s)&&r.push(i)}return r}patchRectXY(t,e,n,s=n,r=!0){return this.patchRect(this.patch(t,e),n,s,r)}cacheIndex(t,e=t,n=!0){return(2*t+1)*(2*e+1)+(n?0:-1)}cacheRect(t,e=t,n=!0,s=!0){const r=this.cacheIndex(t,e,n);this.ask(i=>{i.rectCache&&!s||(i.rectCache=[]);const o=this.inRect(i,t,e,n);i.rectCache[r]=o})}inRect(t,e,n=e,s=!0){const r=this.patchRect(t,e,n,s);return this.isBaseSet()?r:r.withBreed(this)}inRadius(t,e,n=!0){const s=Math.ceil(e);return this.inRect(t,s,s,n).inRadius(t,e,n)}inCone(t,e,n,s,r=!0){const i=Math.ceil(e),o=this.inRect(t,i,i,r);return s=this.model.toRads(s),n=this.model.toRads(s),o.inCone(t,e,n,s,r)}patchAtHeadingAndDistance(t,e,n){e=this.model.toRads(e);let{x:s,y:r}=t;return s+=n*Math.cos(e),r+=n*Math.sin(e),this.patch(s,r)}isOnEdge(t){const{x:e,y:n}=t,{minX:s,maxX:r,minY:i,maxY:o}=this.model.world;return e===s||e===r||n===i||n===o}edgePatches(){return this.filter(t=>this.isOnEdge(t))}diffuse(t,e){this.diffuseN(8,t,e)}diffuse4(t,e){this.diffuseN(4,t,e)}diffuseN(t,e,n){if(void 0===this[0]._diffuseNext)for(let t=0;t<this.length;t++)this[t]._diffuseNext=0;for(let s=0;s<this.length;s++){const r=this[s],i=r[e]*n,o=i/t,h=8===t?r.neighbors:r.neighbors4,a=h.length;r._diffuseNext+=r[e]-i+(t-a)*o;for(let t=0;t<h.length;t++)h[t]._diffuseNext+=o}for(let t=0;t<this.length;t++){const n=this[t];n[e]=n._diffuseNext,n._diffuseNext=0}}}class Tt{agentSet;model;name;static defaultVariables(){return{turtles:void 0,z:0}}constructor(){Object.assign(this,Tt.defaultVariables())}get x(){return this.id%this.model.world.width+this.model.world.minX}get y(){return this.model.world.maxY-Math.floor(this.id/this.model.world.width)}isOnEdge(){return this.patches.isOnEdge(this)}get neighbors(){const t=this.patches.neighbors(this);return Object.defineProperty(this,"neighbors",{value:t,enumerable:!0}),t}get neighbors4(){const t=this.patches.neighbors4(this);return Object.defineProperty(this,"neighbors4",{value:t,enumerable:!0}),t}turtlesHere(){return null==this.turtles&&(this.patches.ask(t=>{t.turtles=new kt}),this.model.turtles.ask(t=>{t.patch.turtles.push(t)})),this.turtles}breedsHere(t){return this.turtlesHere().withBreed(t)}distanceXY(t,e,n=null){return null!=n&&null!=this.z?st(this.x,this.y,this.z,t,e,n):et(this.x,this.y,t,e)}distance(t){const{x:e,y:n,z:s}=t;return this.distanceXY(e,n,s)}towards(t){return this.towardsXY(t.x,t.y)}towardsXY(t,e){let n=Q(this.x,this.y,t,e);return this.model.fromRads(n)}patchAt(t,e){return this.patches.patch(this.x+t,this.y+e)}patchAtHeadingAndDistance(t,e){return this.patches.patchAtHeadingAndDistance(this,t,e)}sprout(t=1,e=this.model.turtles,n=(t=>{})){return e.create(t,t=>{t.setxy(this.x,this.y),n(t)})}}class Bt extends vt{createOne(t=(t=>{})){const e=this.addAgent();return e.theta=C(2*Math.PI),t(e),e}create(t,e=(t=>{})){return ut(t,(t,n)=>{n.push(this.createOne(e))})}closestTurtle(t,e,n){const s=this.inPatchRectXY(t,e,n);return 0===s.length?null:s.minOneOf(n=>n.distanceXY(t,e))}inPatches(t){let e=new kt;for(const n of t)e.push(...n.turtlesHere());return this.isBreedSet()&&(e=e.filter(t=>t.agentSet===this)),e}inPatchRect(t,e,n=e,s=!1){const r=this.inPatchRectXY(t.x,t.y,e,n);return s||at(r,t),r}inPatchRectXY(t,e,n,s=n){const r=this.model.patches.patchRectXY(t,e,n,s,!0);return this.inPatches(r)}inRadius(t,e,n=!1){return this.inPatchRect(t,e,e,!0).inRadius(t,e,n)}inCone(t,e,n,s=!1){const r=this.inPatchRect(t,e,e,!0),i=this.model.toRads(t.direction);return n=this.model.toRads(i),r.inCone(t,e,n,t.theta,s)}layoutCircle(t=.9*this.model.world.maxX,e=[0,0]){const n=Math.PI/2,s=2*Math.PI/this.length,[r,i]=e;this.ask((e,o)=>{e.setxy(r,i),e.theta=n+-1*s*o,e.forward(t)})}}class $t{atEdge="wrap";agentSet;model;name;constructor(){}agentConstructor(){this.theta=null,this.x=0,this.y=0,this.agentSet.setDefault("z",null)}die(){if(this.agentSet.removeAgent(this),this.hasOwnProperty("links"))for(;this.links.length>0;)this.links[0].die();this.patch&&this.patch.turtles&&at(this.patch.turtles,this),this.id=-1}hatch(t=1,e=this.agentSet,n=(t=>{})){return e.create(t,t=>{t.setxy(this.x,this.y,this.z),t.theta=this.theta;for(const n of e.ownVariables)null==t[n]&&(t[n]=this[n]);n(t)})}get links(){return Object.defineProperty(this,"links",{value:new kt(0),enumerable:!0}),this.links}get patch(){return this.model.patches.patch(this.x,this.y)}get heading(){return Y("Turtle.heading is deprecated, use direction instead"),H(this.theta)}set heading(t){Y("Turtle.heading is deprecated, use direction instead"),this.theta=q(t)}get direction(){return this.model.fromRads(this.theta)}set direction(t){this.theta=F(this.model.toRads(t))}setxy(t,e,n){const s=this.patch;this.x=t,this.y=e,null!=n&&(this.z=n),this.checkXYZ(s)}checkXYZ(t){this.checkEdge(),this.checkPatch(t)}checkEdge(){const{x:t,y:e,z:n}=this;this.model.world.isOnWorld(t,e,n)||"OK"===this.atEdge||this.handleEdge(t,e,n)}checkPatch(t){const e=this.patch;e!=t&&(t&&t.turtles&&at(t.turtles,this),e&&e.turtles&&e.turtles.push(this))}handleEdge(t,e,n){let s=this.atEdge;if(St(s)){const{minXcor:r,maxXcor:i,minYcor:o,maxYcor:h,minZcor:a,maxZcor:c}=this.model.world;if("wrap"===s)this.x=B(t,r,i),this.y=B(e,o,h),null!=n&&(this.z=B(n,a,c));else{if("clamp"!==s&&"bounce"!==s)throw Error("turtle.handleEdge: bad atEdge: "+s);this.x=$(t,r,i),this.y=$(e,o,h),null!=n&&(this.z=$(n,a,c)),"bounce"===s&&(this.x===r||this.x===i?this.theta=Math.PI-this.theta:this.y===o||this.y===h?this.theta=-this.theta:this.z!==a&&this.z!==c||(this.pitch?this.pitch=-this.pitch:this.z=B(n,a,c)))}}else this.atEdge(this)}moveTo(t){this.setxy(t.x,t.y,t.z)}forward(t){this.setxy(this.x+t*Math.cos(this.theta),this.y+t*Math.sin(this.theta))}rotate(t){t=this.model.toCCW(t),this.direction+=t}right(t){this.rotate(-t)}left(t){this.rotate(t)}face(t){this.direction=this.towards(t)}facexy(t,e){this.direction=this.towardsXY(t,e)}patchAhead(t){return this.patchAtHeadingAndDistance(this.direction,t)}patchRightAndAhead(t,e){return"heading"===this.model.geometry&&(t=-t),this.patchAtHeadingAndDistance(this.direction-t,e)}patchLeftAndAhead(t,e){return this.patchRightAndAhead(-t,e)}canMove(t){return null!=this.patchAhead(t)}distanceXY(t,e,n=null){return null!=n&&null!=this.z?st(this.x,this.y,this.z,t,e,n):et(this.x,this.y,t,e)}distance(t){const{x:e,y:n,z:s}=t;return this.distanceXY(e,n,s)}get dx(){return Math.cos(this.theta)}get dy(){return Math.sin(this.theta)}towards(t){return this.towardsXY(t.x,t.y)}towardsXY(t,e){let n=Q(this.x,this.y,t,e);return this.model.fromRads(n)}patchAt(t,e){return this.model.patches.patch(this.x+t,this.y+e)}patchAtHeadingAndDistance(t,e){return this.model.patches.patchAtHeadingAndDistance(this,t,e)}otherEnd(t){return t.end0===this?t.end1:t.end0}linkNeighbors(){return this.links.map(t=>this.otherEnd(t))}isLinkNeighbor(t){return t in this.linkNeighbors()}}class zt{world;patches;turtles;links;ticks;geometry="radians";constructor(t=It.defaultOptions(),e=!0){this.resetModel(t),e&&this.autoTick(),this.setGeometry(this.geometry)}initAgentSet(t,e,n){this[t]=new e(this,n,t)}resetModel(t){this.ticks=0,this.world=void 0===t.maxXcor?new It(t):t,this.initAgentSet("patches",jt,Tt),this.initAgentSet("turtles",Bt,$t),this.initAgentSet("links",Rt,Pt)}reset(t=this.world){this.resetModel(t)}tick(){this.ticks++}async startup(){}setup(){}step(){}stepAndTick(){this.step0(),this.tick()}autoTick(){this.step0=this.step,this.step=this.stepAndTick}patchBreeds(t){for(const e of t.split(" "))this[e]=this.patches.newBreed(e)}turtleBreeds(t){for(const e of t.split(" "))this[e]=this.turtles.newBreed(e)}linkBreeds(t){for(const e of t.split(" "))this[e]=this.links.newBreed(e)}setGeometry(t){const e=Wt[t];if(!e)throw Error(`model.setGeometry: ${t} geometry not defined`);Object.assign(this,e),this.geometry=t}}const Nt=180/Math.PI,Dt=Math.PI/180,Wt={radians:{toRads:t=>t,fromRads:t=>t,toCCW:t=>t},degrees:{toRads:t=>t*Dt,fromRads:t=>t*Nt,toCCW:t=>t},heading:{toRads:t=>(90-t)*Dt,fromRads:t=>90-t*Nt,toCCW:t=>-t}};class Zt extends Et{static rgbToInt24(t,e,n){return 256*t*256+256*e+n}constructor(t,e=Zt.rgbToInt24,n=Float32Array){super(t.width,t.height,new n(t.width*t.height)),Array.isArray(e)&&(e=Zt.newRgbDataFunction(e));const s=y(t.width,t.height);S(s,t);const r=O(s),i=this.data;for(var o=0;o<i.length;o++){const t=r.data[4*o],n=r.data[4*o+1],s=r.data[4*o+2];i[o]=e(t,n,s)}}}console.warn("util.js is deprecated, please use utils.js which has individual exports\n    To replace: import util from src/util.js\n    Use: import * as util from src/utils.js");export{kt as AgentArray,vt as AgentSet,Et as DataSet,Pt as Link,Rt as Links,zt as Model,Tt as Patch,jt as Patches,Zt as RGBDataSet,$t as Turtle,Bt as Turtles,It as World,d as gis,Mt as util};
